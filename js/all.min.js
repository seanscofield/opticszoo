var k,aa,ba,ca,da;function ea(){var e=document.getElementById("helpModal"),t=document.getElementsByClassName("close")[0];document.getElementById("help").onclick=function(){e.style.display="block"},t.onclick=function(){e.style.display="none"},window.onclick=function(t){t.target==e&&(e.style.display="none")}}function fa(){ea(),helpIcon=document.getElementById("help"),aa=document.getElementById("load"),ba=document.getElementById("save"),ca=document.getElementById("redo"),da=document.getElementById("undo"),(fileInput=document.getElementById("fileInput")).addEventListener("change",function(t){t=t.target.files[0],console.log(t);var e=new FileReader;e.readAsText(t),console.log(e.result),e.onload=function(){p.load(JSON.parse(e.result))},e.onerror=function(){alert(e.error)}}),aa.addEventListener("click",function(){document.getElementById("fileInput").click()}),ba.addEventListener("click",function(){var t=JSON.stringify(ga()),t=new Blob([t],{type:"text/plain"}),e=document.createElement("a");e.download=window.prompt("Enter a name for the file being saved"),e.href=window.URL.createObjectURL(t),e.click()}),da.addEventListener("click",function(){ha()}),ca.addEventListener("click",function(){ia()})}function q(t,e){this.A=t,this.h=e}function ja(t){return[t.A*Math.cos(t.h),t.A*Math.sin(t.h)]}function ka(t){return new q(t.A,t.h+Math.PI)}function la(t,e,i,n){i/=n;var a=(n=t.A*e.A*Math.cos(e.h-t.h))<0?-1:1;return t=ja(new q(t.A*i,t.h)),i=ja(new q(e.A*a*(Math.sqrt(1-Math.pow(i,2)*(1-Math.pow(n,2)))-a*i*n),e.h)),e=t[0]+i[0],t=t[1]+i[1],new q(Math.sqrt(e*e+t*t),Math.atan2(t,e)).normalize()}function ma(e,i,n,a,s,o,h,r,l){var c=[],u=[e,i];return e=[n-e,a-i],i=[h*Math.cos(r)+s,h*Math.sin(r)+o],r=[h*Math.cos(r+l)+s,h*Math.sin(r+l)+o],s=t(u,w([s,o],-1)),0==(h=Math.pow(x(e,s),2)-x(e,e)*(x(s,s)-h*h))?z(i,r,u,e,-1*x(e,s)/x(e,e),c):0<h&&(o=(-1*x(e,s)-Math.sqrt(h))/x(e,e),z(i,r,u,e,(-1*x(e,s)+Math.sqrt(h))/x(e,e),c),z(i,r,u,e,o,c)),c}function z(e,i,n,a,s,o){n=t(n,w(a,s)),a=t(n,w(e,-1));var h=t(i,w(e,-1));a=a[0]*h[1]-h[0]*a[1],(e=(0!=t(i,w(e,-1))[0]||0!=t(i,w(e,-1))[1])&&0<=a)&&0<=s&&s<=1&&o.push(n)}function t(t,e){if(t.length==e.length)for(var i=Array(t.length),n=i.length-1;0<=n;n--)i[n]=t[n]+e[n];else i=!1;return i}function w(t,e){for(var i=Array(t.length),n=i.length-1;0<=n;n--)i[n]=e*t[n];return i}function x(t,e){if(t.length==e.length)for(var i=0,n=t.length-1;0<=n;n--)i+=t[n]*e[n];return i}function A(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))}function na(t,e){e.forEach(function(t){this.push(t)},t)}function C(t,e){return(t%e+e)%e}function D(t,e,i){return null==i&&(i=.001),Math.abs(t-e)<i}function oa(t,e,i,n,a,s,o,h){var r,l,c,u={x:null,y:null},d=(h-s)*(i-t)-(o-a)*(n-e);return 0!=d&&(c=(i-t)*(r=e-s)-(n-e)*(l=t-a),r=((o-a)*r-(h-s)*l)/d,l=c/d,u.x=t+r*(i-t),u.y=e+r*(n-e),0<=r&&r<=1&&0<=l&&l<=1&&u)}function pa(t,e,i){this.x=t,this.y=e,this.ga=i,this.da=30,this.color="#ace600",this.reset()}function qa(t){for(var e,i=t.f,n=t.g,a=t.f+Number.MAX_SAFE_INTEGER*Math.cos(t.h),s=t.g+Number.MAX_SAFE_INTEGER*Math.sin(t.h),o=p.o,h=0;h<4;h+=1)if((e=oa(i,n,a,s,(e=o[h]).f,e.g,e.D,e.F))&&(!D(e.x,i,.001)||!D(e.y,n,.001))){t.D=Math.round(e.x),t.F=Math.round(e.y);break}}function ra(t){var e=t.path,i=e.length;for(ctx.strokeStyle=t.color,ctx.lineWidth=sa,ctx.beginPath(),ctx.moveTo(t.path[0][0],t.path[0][1]),t=1;t<i;t+=1)ctx.lineTo(e[t][0],e[t][1]);ctx.stroke()}function ta(t,e,i,n,a){this.x=t,this.y=e,this.R=i,this.rotation=n,this.V=a,this.attributes=["x","y","h","rotation","numRays"],this.type="lightSource",ua(this)}function ua(t){t.W=[];for(var e=t.R/t.V,i=0;i<t.V;i+=1)t.W.push(new pa(t.x-i*e*Math.sin(t.rotation),t.y-t.R/2+i*e*Math.cos(t.rotation),t.rotation))}function G(t){var e=t.R,i=t.x+e/2*Math.sin(t.rotation),n=t.y+e/2*Math.cos(t.rotation),a=i-e/2*Math.cos(t.rotation),s=n-e/4*Math.cos(t.rotation),o=a-3*e/5*Math.cos(t.rotation),h=s-e/2*Math.sin(t.rotation),r=o-4*e/5*Math.sin(t.rotation),l=h-6*e/11*Math.cos(t.rotation),e=l-e/6,c=[];c.push(new H(i,n,a,s)),c.push(new H(a,s,o,h)),c.push(new H(o,h,r,l)),c.push(new H(r,l,a,l)),c.push(new H(a,l,i,e)),c.push(new H(i,e,i,n)),t.o=c}q.prototype.normalize=function(){return new q(1,this.h)},pa.prototype.reset=function(){this.f=this.x,this.g=this.y,this.h=this.ga,this.path=[[this.f,this.g]],this.n=1,qa(this)},k=ta.prototype,k.O=function(t,e){this[t]=e,p.valid=!1,E.display()},k.X=function(t,e){ua(this);for(var i=this.W.length,n=0;n<i;n+=1)t:{var a=this.W[n],s=t,o=e,h=void 0,r=void 0,l=a.da;a.reset();for(var c=0;c<l;c+=1){for(var u=a,d=s,h=u.f,f=u.g,g=void 0,r=[],y=d.length,m=0;m<y;m+=1)!(g=d[m].S(u))||D(g.x,h,.01)&&D(g.y,f,.01)||r.push(g);if(0<r.length){for(d=u=void 0,y=A((g=r[0]).x,g.y,h,f),m=0;m<r.length;m+=1)(u=A((d=r[m]).x,d.y,h,f))<y&&(g=d,y=u);h=g}else h=!1;if(!h)break;if(a.path.push([h.x,h.y]),r=h.curve,h.element.n<0){ra(a);break t}f=new q(1,a.h),r=h.element.I(r,h.x,h.y),m=f.A*r.A*Math.cos(r.h-f.h)<0?h.element.n:1,u=la(f,r,a.n,m),isNaN(u.h)?u=ka(la(f,r,m=a.n,-1*m)):a.n=m,a.h=C(u.h,2*Math.PI),a.f=h.x,a.g=h.y,qa(a)}if(c<l)for(c=0;c<4;c+=1)if((h=o[c].S(a))&&(!D(h.x,a.f,.01)||!D(h.y,a.g,.01))){a.path.push([h.x,h.y]);break}ra(a)}this.u(p.l)},k.u=function(t){G(this);var e=this.o;path=this.path=new Path2D,t.fillStyle="#996633",t.beginPath(),path.moveTo(e[0].f,e[0].g);for(var i=e.length,n=0;n<i;n+=1)e[n].u(path);t.closePath(),t.drawImage(I,this.x-85,this.y-44,85,85)},k.Y=function(t){G(this);var e=this.o;path=this.path=new Path2D,t.beginPath(),t.strokeStyle="#ffcc00",t.lineWidth=2,path.moveTo(e[0].f,e[0].g);for(var i=e.length,n=0;n<i;n+=1)e[n].u(path);t.closePath(),t.drawImage(J,this.x-85,this.y-44,85,85)},k.contains=function(t,e){return p.l.isPointInPath(this.path,t,e)},k.M=function(){return"lightSource("+this.x.toString()+","+this.y.toString()+","+this.R.toString()+","+this.rotation.toString()+","+this.V.toString()+");"};var K=!1,va=!1,L=1,M=0,N=0,wa=0,xa=0,ya;function za(t,e,i){var n;(i=Math.round(50*i)/50)>p.fa&&i<p.ea&&(n=L-i,L=i,M=t=M+t*n,N=e=N+e*n,p.l.setTransform(L,0,0,L,M,N))}function Aa(t){this.canvas=t,this.width=t.width,this.canvas.height-=15,this.height=t.height,this.canvas.style["background-color"]="#1a1a1a",Ba(this),Ca(this),ya=document.getElementById("banner").getBoundingClientRect().height,this.$=0,this.fa=this.height/8e3/100,this.ea=this.height/8e3*200,this.l=t.getContext("2d"),document.defaultView&&document.defaultView.getComputedStyle&&(this.ja=parseInt(document.defaultView.getComputedStyle(t,null).paddingLeft,10)||0,this.ka=parseInt(document.defaultView.getComputedStyle(t,null).paddingTop,10)||0,this.ha=parseInt(document.defaultView.getComputedStyle(t,null).borderLeftWidth,10)||0,this.ia=parseInt(document.defaultView.getComputedStyle(t,null).borderTopWidth,10)||0);var e=document.body.parentNode,s=(this.ca=e.offsetTop,this.ba=e.offsetLeft,this.valid=!1,this.s=[],this.N=this.L=!1,this.selection=null,this.w=this.G=0,this);t.addEventListener("selectstart",function(t){return t.preventDefault(),!1},!1),t.addEventListener("mousedown",function(t){t=(i=O(s,t)).x;var e=i.y,i=Da(t,e);if("planoconvex"==P)t=new Q(i.x,i.y,0,1.5,3e4,-100,50,40,"#33cccc"),S(p,t),P="default";else if("planoconcave"==P)t=new Q(i.x,i.y,0,1.5,3e4,100,50,20,"#33cccc"),S(s,t),P="default";else if("medium"==P)t=new Q(i.x,i.y,0,1.5,3e4,3e4,60,120,"#33cccc"),S(s,t),P="default";else if("lightSource"==P){var n=new ta(i.x,i.y,80,0,15);(t=p).v=n,t.valid=!1,P="default"}else if("mirror"==P)t=new Q(i.x,i.y,0,0,3e4,3e4,70,15,"#cccccc"),S(p,t),P="default";else if("wall"==P)t=new Q(i.x,i.y,0,-1,3e4,3e4,70,15,"#996633"),S(p,t),P="default";else if(T)s.G=t,s.w=e,s.N=!0;else if(U)s.G=t,s.w=e,s.U=!0;else if(s.v&&s.v.contains(t,e))t=s.v,V?(s.aa=Math.atan2(i.y-t.y,i.x-t.x),s.T=!0):(s.G=i.x-t.x,s.w=i.y-t.y,s.L=!0),s.selection=t,s.Z=s.selection.rotation,E.element=t,E.display(),(t=document.getElementById("attrBox")).style.visibility="visible",s.valid=!1;else{for(var a=s.s,n=(n=a.length)-1;0<=n;n--)if(a[n].contains(t,e))return t=a[n],E.element=t,E.display(),V?(s.aa=Math.atan2(i.y-t.y,i.x-t.x),s.T=!0):(s.G=i.x-t.x,s.w=i.y-t.y,s.L=!0),s.selection=t,s.Z=s.selection.rotation,s.valid=!1,void((t=document.getElementById("attrBox")).style.visibility="visible");s.selection&&(s.selection=null,s.valid=!1)}},!0),t.addEventListener("mousemove",function(t){var e;if(va||!s.L&&!s.T||(e=O(s,t),W(s),va=!0),e=O(s,t),s.N)wa=e.x-s.G,xa=e.y-s.w,s.l.setTransform(L,0,0,L,M+wa,xa+N),s.valid=!1;else if(s.U)za((e=Da(s.G,s.w)).x,e.y,L*(1+.05*(0<t.la?1:-1))),s.valid=!1;else if(s.L)s.selection.x=(e.x-M)/L-s.G,s.selection.y=(e.y-N)/L-s.w,s.valid=!1;else if(s.T)(t=s.selection).rotation=C(s.Z+Math.atan2((e.y-N)/L-s.selection.y,(e.x-M)/L-s.selection.x)-s.aa,2*Math.PI),t.update(),s.valid=!1;else{for(var i=(t=s.s).length-1;0<=i;i--)if(t[i].contains(e.x,e.y))return void(K=!0);K=!1}},!0),t.addEventListener("mouseup",function(t){va=!1,s.L=!1,s.T=!1,s.U?(t=O(s,t),s.$+=t.y-s.w,s.U=!1):s.N&&(t=O(s,t),M+=t.x-s.G,N+=t.y-s.w,s.N=!1)},!0),t.addEventListener("wheel",function(t){var e=O(s,t);za((e=Da(e.x,e.y)).x,e.y,L*(1+.1*(t.deltaY<0?1:-1))),p.valid=!1},!0),requestAnimationFrame(this.u.bind(this))}function S(t,e){W(t),t.s.push(e),t.valid=!1}function Da(t,e){return{x:(t-M)/L,y:(e-N)/L}}function Ca(t){var e,i=50*L,n=t.N?(e=C(wa+M+1,i),C(xa+N+ya,i)):(e=C(M+1,i),C(N+ya,i));t.canvas.style.backgroundSize=i+"px "+i+"px",t.canvas.style.backgroundPositionX=e+"px",t.canvas.style.backgroundPositionY=n+"px"}function O(t,e){var i=t.canvas,n=0,a=0;if(void 0!==i.offsetParent)for(;n+=i.offsetLeft,a+=i.offsetTop,i=i.offsetParent;);return n+=t.ja+t.ha+t.ba,a+=t.ka+t.ia+t.ca,{x:e.pageX-n,y:e.pageY-a}}function Ba(t){var e=[];e.push(new H(-4e3,-4e3,4e3,-4e3)),e.push(new H(4e3,-4e3,4e3,4e3)),e.push(new H(4e3,4e3,-4e3,4e3)),e.push(new H(-4e3,4e3,-4e3,-4e3)),t.o=e}function ha(){var t=p;X.length&&(Y.push(Ea(t)),t.s=X.pop(),t.selection=null,t.valid=!1)}function ia(){var t=p;Y.length&&(X.push(Ea(t)),t.s=Y.pop(),t.selection=null,t.valid=!1)}function Ea(t){for(var e=[],i=(t=t.s).length,n=0;n<i;n++)e.push(Fa(t[n]));return e}function ga(){var t=p,e={},i=t.s;e.elements=[];for(var n=0;n<i.length;n++)e.elements.push(t.s[n].M());return e.lightSources=t.v?[t.v.M()]:[],e}function W(t){var e=Ea(t);Y=[],X.push(e),t.valid=!1}function H(t,e,i,n){this.f=t,this.g=e,this.D=i,this.F=n,this.type="line"}function Ga(){}function Z(){this.type="CircularSegment",this.c=new Ga}function Ha(t){t.c.x=t.x+Math.cos(t.rotation)*t.r,t.c.y=t.y+Math.sin(t.rotation)*t.r,t.c.r=Math.abs(t.r);var e=Math.asin(t.H/Math.abs(t.r));t.m=e,0<t.r?(t.B=t.c.x-Math.cos(e-t.rotation)*t.r,t.C=t.c.y+Math.sin(e-t.rotation)*t.r,t.J=t.c.x-Math.cos(0-e-t.rotation)*t.r,t.K=t.c.y+Math.sin(0-e-t.rotation)*t.r):(t.J=t.c.x-Math.cos(e-t.rotation)*t.r,t.K=t.c.y+Math.sin(e-t.rotation)*t.r,t.B=t.c.x-Math.cos(0-e-t.rotation)*t.r,t.C=t.c.y+Math.sin(0-e-t.rotation)*t.r)}function Element(t,e,i,n){this.x=t,this.y=e,this.rotation=i,this.n=n}function Q(t,e,i,n,a,s,o,h,r){Element.apply(this,arguments),this.i=a,this.j=s,this.rotation=i,this.color=r,this.P=h,this.H=o,this.attributes=["r1","r2","semi_diameter","n","w"],this.o=[],this.o.push(new H),this.o.push(new H),this.a=new Z,this.b=new Z,this.u(p.l)}function Fa(t){return new Q(t.x,t.y,t.rotation,t.n,t.i,t.j,t.H,t.P,t.color)}function Ia(){this.element=void 0,this.display()}k=Aa.prototype,k.clear=function(){this.l.clearRect(-8e3,-8e3,18e3,18e3)},k.u=function(){if(V&&K?(t=document.getElementsByTagName("body")[0]).style.cursor="url('images/png/cursors/rotate-cursor-hot-pink.png') 15 15, auto":T?(t=document.getElementsByTagName("body")[0]).style.cursor="url('images/png/cursors/scroll-cursor-hot-pink.png') 15 15, auto":U?(t=document.getElementsByTagName("body")[0]).style.cursor="url('images/png/cursors/zoom-plus-cursor-white.png') 15 15, auto":"default"==P&&((t=document.getElementsByTagName("body")[0]).style.cursor="default"),!this.valid){var t=this.l,e=this.s,i=(this.clear(),Ca(this),this.o);this.l.beginPath(),this.l.strokeStyle="green",this.l.lineWidth=100,this.l.moveTo(i[0].f,i[0].g);for(var n=0;n<i.length;n+=1)i[n].u(this.l);for(this.l.stroke(),i=e.length,n=0;n<i;n++)e[n].u(t);null!=this.selection?this.selection.Y(t):document.getElementById("attrBox").style.visibility="hidden",this.v&&this.X(this.v),this.valid=!0}requestAnimationFrame(this.u.bind(this))},k.X=function(){return this.v.X(this.s,this.o)},k.M=function(){for(var t="",e=this.s,i=e.length,n=0;n<i;n++)t+=e[n].M();return t+this.v.M()},k.load=function(a){for(var b=[],c=a.elements,d,e=0;e<c.length;e++)d=c[e],"string"==typeof d&&b.push(eval("new "+d));for(this.s=b,e=0;e<a.lightSources.length;e+=1)this.v=eval("new "+a.lightSources[0]);this.selection=null,this.valid=!1},H.prototype.update=function(t,e,i,n){this.f=t,this.g=e,this.D=i,this.F=n},H.prototype.S=function(t){return!!(t=oa(t.f,t.g,t.D,t.F,this.f,this.g,this.D,this.F))&&{x:t.x,y:t.y,curve:this}},H.prototype.I=function(){return new q(1,Math.atan2(this.D-this.f,this.g-this.F))},H.prototype.u=function(t){t.lineTo(this.D,this.F)},Z.prototype.update=function(t,e,i,n,a){this.x=t,this.y=e,this.r=i,this.rotation=a,this.H=n,Ha(this)},Z.prototype.I=function(t,e){return new q(1,Math.atan2(e-this.c.y,t-this.c.x))},Z.prototype.u=function(t){Ha(this);var e=0,i=(this.r<0&&(e=Math.PI),Math.asin(this.H/Math.abs(this.r)));t.arc(this.c.x,this.c.y,Math.abs(this.r),this.rotation+e+Math.PI-i,this.rotation+Math.PI+i+e)},Element.prototype.O=function(t,e){this[t]=e,G(this),p.valid=!1},k=Q.prototype,k.update=function(){var t=this.H,e=this.j,i=this.rotation,n=this.x,a=this.y,s=this.P,o=this.a,h=this.b,r=n+Math.cos(i)*s/2,l=a+Math.sin(i)*s/2;this.a.update(n-Math.cos(i)*s/2,a-Math.sin(i)*s/2,this.i,t,i),this.b.update(r,l,e,t,i),this.o[0].update(o.B,o.C,h.B,h.C),this.o[1].update(h.J,h.K,o.J,o.K)},k.u=function(t){this.update(),t.fillStyle=this.color;var e=new Path2D,i=(t.beginPath(),this.a.c.x-Math.cos(this.rotation)*this.i/Math.sin(Math.PI/2-this.a.m)),n=this.a.c.y-Math.sin(this.rotation)*this.i/Math.sin(Math.PI/2-this.a.m),a=this.b.c.x-Math.cos(this.rotation)*this.j/Math.sin(Math.PI/2-this.b.m),s=this.b.c.y-Math.sin(this.rotation)*this.j/Math.sin(Math.PI/2-this.b.m);e.moveTo(this.a.B,this.a.C),e.lineTo(this.b.B,this.b.C),e.arcTo(a,s,this.b.J,this.b.K,Math.abs(this.j)),e.lineTo(this.a.J,this.a.K),e.arcTo(i,n,this.a.B,this.a.C,Math.abs(this.i)),t.closePath(),t.fill(e),this.path=e},k.Y=function(t){this.update();var e=new Path2D,i=(t.beginPath(),t.strokeStyle="#ffcc00",t.lineWidth=2,this.a.c.x-Math.cos(this.rotation)*this.i/Math.sin(Math.PI/2-this.a.m)),n=this.a.c.y-Math.sin(this.rotation)*this.i/Math.sin(Math.PI/2-this.a.m),a=this.b.c.x-Math.cos(this.rotation)*this.j/Math.sin(Math.PI/2-this.b.m),s=this.b.c.y-Math.sin(this.rotation)*this.j/Math.sin(Math.PI/2-this.b.m);e.moveTo(this.a.B,this.a.C),e.lineTo(this.b.B,this.b.C),e.arcTo(a,s,this.b.J,this.b.K,Math.abs(this.j)),e.lineTo(this.a.J,this.a.K),e.arcTo(i,n,this.a.B,this.a.C,Math.abs(this.i)),t.closePath(),t.stroke(e),this.path=e},k.contains=function(t,e){return p.l.isPointInPath(this.path,t,e)},k.getAttribute=function(t){return"r1"==t?this.i:"r2"==t?this.j:"semi_diameter"==t?this.H:"n"==t?this.n:"w"==t?this.P:void 0},k.O=function(t,e){"r1"!=t&&"r2"!=t||(e=0<e?Math.min(3e4,e):Math.max(-3e4,e)),"r1"==t?this.i=e:"r2"==t?this.j=e:"semi_diameter"==t?this.H=e:"n"==t?this.n=e:"w"==t&&(this.P=e),p.valid=!1,E.display()},k.S=function(t){for(var e,i=[],n=0;n<this.o.length;n+=1)!(e=(e=this.o[n]).S(t))||D(e.x,t.f,.1)&&D(e.y,t.g,.1)||i.push(e);if(i.length){for(var a,s=i[0],o=A(s.x,s.y,t.f,t.g),n=0;n<i.length;n+=1)(e=A((a=i[n]).x,a.y,t.f,t.g))<o&&(s=a,o=e);s.element=this,i=s}else i=!1;return e=0<this.j?this.rotation+Math.PI-this.b.m:this.rotation-this.b.m,n=ma(t.f,t.g,t.D,t.F,this.a.c.x,this.a.c.y,Math.abs(this.i),0<this.i?this.rotation+Math.PI-this.a.m:this.rotation-this.a.m,2*this.a.m),e=ma(t.f,t.g,t.D,t.F,this.b.c.x,this.b.c.y,Math.abs(this.j),e,2*this.b.m),na(a=[],n),na(a,e),n=1==a.length?{x:a[0][0],y:a[0][1],curve:n.length?this.a:this.b,element:this}:2==a.length&&(n=[a[0][0],a[0][1]],e=[a[1][0],a[1][1]],a=A(n[0],n[1],t.f,t.g),s=A(e[0],e[1],t.f,t.g),D(n[0],t.f,.1)&&D(n[1],t.g,.1)||!(a<s||D(e[0],t.f,.1)&&D(e[1],t.g,.1))?{x:e[0],y:e[1],curve:this.b,element:this}:{x:n[0],y:n[1],curve:this.a,element:this}),boxDist=i&&A(i.x,i.y,t.f,t.g),arcDist=n&&A(n.x,n.y,t.f,t.g),boxDist<.001&&(i=!1),arcDist<.001&&(n=!1),(!1!==i||!1!==n)&&(!1!==i&&(!1===n||boxDist<arcDist)?i:n)},k.I=function(t,e,i){return t==this.a&&0<this.i?t.I(e,i):t==this.a&&this.i<0||t==this.b&&0<this.j?ka(t.I(e,i)):t==this.b&&this.j<0?t.I(e,i):"line"==t.type?t.I():void 0},k.M=function(){return"Lens("+this.x.toString()+","+this.y.toString()+","+this.rotation.toString()+","+this.n.toString()+","+this.i.toString()+","+this.j.toString()+","+this.H.toString()+","+this.P.toString()+",'"+this.color.toString()+"');"},Ia.prototype.O=function(t){var e=t.srcElement.parentNode.parentNode.children[0].innerHTML;t=t.srcElement.value,W(p),this.element.O(e,t)},Ia.prototype.display=function(){var t=document.getElementById("attrBox"),e=document.createElement("hello");if(this.element){for(var i,n,a,s=this.element.attributes,o=0;o<s.length;o+=1)key=s[o],-1<s.indexOf(key)&&(n=(i=document.createElement("tr")).insertCell(0),a=i.insertCell(1),n.innerHTML=key,a.innerHTML+='<input type="text" name="fname">',a.children[0].value=this.element.getAttribute(key),a.contentEditable="true",a.children[0].addEventListener("change",this.O.bind(this),!1),e.appendChild(i));t.replaceChild(e,t.children[0])}};var E,p,P="default",U=!1,sa=3,V=!1,T=!1,X=[],Y=[],I,J;function Ja(){var t=document.getElementsByTagName("body")[0];document.getElementById("plano-convex").onclick=function(){t.style.cursor="url('images/png/plano-convex.png') 50 50, auto",P="planoconvex"},document.getElementById("plano-concave").onclick=function(){t.style.cursor="url('images/png/plano-concave.png') 50 50, auto",P="planoconcave"},document.getElementById("medium").onclick=function(){t.style.cursor="url('images/png/medium.png') 50 50, auto",P="medium"},document.getElementById("lightSource").onclick=function(){t.style.cursor="url('images/png/lightSource.png') 50 50, auto",P="lightSource"},document.getElementById("mirror").onclick=function(){t.style.cursor="url('images/png/mirror.png') 50 50, auto",P="mirror"},document.getElementById("wall").onclick=function(){t.style.cursor="url('images/png/wall.png') 50 50, auto",P="wall"}}function Ka(){document.addEventListener("keydown",function(t){if(t.shiftKey)V=!0;else{if(" "==t.key)return t.preventDefault(),t.stopPropagation(),!(T=!0);if(77==t.keyCode)U=!0;else if(46!=t.keyCode&&8!=t.keyCode||"text"==t.target.type)90==t.keyCode&&t.ctrlKey?ha():89==t.keyCode&&t.ctrlKey&&ia();else{var e=(t=p).selection;if(W(t),e==t.v)t.v=null;else for(var i=t.s,n=i.length,a=0;a<n;a+=1)i[a]==e&&i.splice(a,1);t.selection=null,t.L=!1,t.valid=!1}}},!0),window.addEventListener("keyup",function(t){V&&!t.shiftKey?V=!1:T&&32==t.keyCode?T=!1:U&&77==t.keyCode&&(U=!1)},!0),window.addEventListener("resize",function(){p.canvas.width=window.innerWidth-10,p.canvas.height=window.innerHeight-82,p.width=p.canvas.width,p.height=p.canvas.height,p.valid=!1},!0)}document.addEventListener("DOMContentLoaded",function(){var t;fa(),Ja(),(ctx=document.getElementById("myCanvas").getContext("2d")).canvas.width=window.innerWidth-10,ctx.canvas.height=window.innerHeight-60,p=new Aa(document.getElementById("myCanvas")),E=new Ia,queryParams=new URLSearchParams(window.location.search),console.log(queryParams),queryParams.has("canvasState")&&(t=JSON.parse(atob(queryParams.get("canvasState"))),p.load(t)),Ka(),(I=new Image).src="images/png/flashlight.png",(J=new Image).src="images/png/highlighted_flashlight.png"},!1);
